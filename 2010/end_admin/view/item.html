<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN"> 
<head>
	<!-- INCLUDE meta.html -->
</head>
<body>
<div class='maindiv'>

<div class="headerdiv">
	<!-- INCLUDE header.html -->
</div>

<div id='content'>
	<div id='admin_left' onselectstart="return false;">
		<div id="admin_left_b">
	    	<div class="module">
	        	<h2>{CATEGORIES_TREE}</h2>
				<div id="category_tree" style="display:none">
					<ul>
						<li><a href="admin.php?p=item" <!-- IF category_id="0" -->class="tree_on" <!-- ENDIF --> >{ROOT_CATEGORY}</a></li>
						<li>{all_category}</li>
					</ul>
					<div style="clear:both;"></div>
				</div>
	        </div>
		</div>
    </div>

    <div id='main'>
	
        <div id="main_b">
			<div id="position">
				{CURRENT_POSITION}:{NAVI_ITEM} > <a href="admin.php?p=item">{CATEGORY_ROOT}</a> > 
				<!-- BEGIN position -->
				 <a href="admin.php?p=item&category_id={category_id}">{name}</a> > 
				<!-- END -->
			</div>
			
			<!-- IF err_msg -->
			<div class="error">
			{err_msg}
			</div>
			<!-- ENDIF -->
			
	  	    <!-- IF page_content -->
		        	{page_content}
					<br />
		    <!-- ELSE -->
			
			
			<div id="admin_content">
			<!-- IF this_category.is_list -->
				<!-- IF category_id -->
				<div class="nav_wrapper">
					&nbsp;{FUNCTION}:
					<?php if(check_show('add')){?>
					<a class="nav" href="admin.php?p=item&action=new_item&category_id={category_id}">{NEW_ITEM}</a>
					<?php };?>
				</div>
				<!-- ENDIF -->
				
				
				<!-- IF statuses -->
				<div class="nav_wrapper">
					&nbsp;{DISPLAY}:
					<a 
						href="admin.php?p=item&category_id={category_id}"  
						class="nav <!-- IF current_status_all -->nav_on<!-- ENDIF -->">{SHOW_ALL}</a>
					<!-- BEGIN statuses -->
					<a 
						href="admin.php?p=item&status={index}&category_id={parent.category_id}" 
						class="nav <!-- IF index==parent.status -->nav_on<!-- ENDIF -->">{strip_tags(value)}</a>
					<!-- END -->
				</div>
				<!-- ENDIF -->
			
				{list_content}
			
			<!-- ELSE -->
				<!-- IF category_id -->
					<h2>栏目类型: {category_type}</h2>
					<a href="admin.php?p=category&action=edit_category&category_id={category_id}">编辑</a>
					<table class="view-table">
					<?php
					foreach($view_data['category_fields'] as $key=>$field)
					{
						echo '<tr>';
						echo '<th>'.$field['name'].'</th>';
						echo '<td>'.$view_data['category'][$key].'</td>';
						echo '</tr>';
					}
					?>
					</table>
				<!-- ELSE -->
				<!--
					TODO 内容管理首页
				-->
				<!-- ENDIF -->
			<!-- ENDIF -->
			</div>
        <!-- ENDIF -->
        </div>
    </div>
	<div style="clear:both;"></div>
</div>

<script type="text/javascript">
$(function()
{
	var root = $('#category_tree').children('ul');
	root.find('a.status_folder').click(function(event)
	{
		event.preventDefault();
		$(this).prev().trigger('click');
		return false;
	});
});

function delete_item(id,o)
{
	if (!confirm('{DELETE_CONFIRM}')) return;
	$(o).attr('to_be_delete','yes').html('{DELETING}').unbind('click');
	$.post('admin.php?p=ajax&m=delete&table={table}&id='+id,{ },delete_callback);
}
function delete_callback(s)
{
	if (s == 'error')
	{
		alert('{DELETE_ERROR}');
		return false;
	}
	$('[to_be_delete=yes]').parents('tr').fadeOut();
}
function change_category(o)
{
	if ($(o).val())
	{
		window.location = "admin.php?p=item&category_id="+ $(o).val();
	}
}

function change_status(id,value,o)
{
	$(o).attr('to_be_delete','yes').html('{DELETING}').unbind('click');
	$.post('admin.php?p=ajax&m=update&column=status&table={table}&id='+id,{ value:value },function(s)
	{
		if (parseInt(s) != s)  alert(s);
		else
			delete_callback();
	});
}
</script>
<!-- INCLUDE footer.html -->

</div>
</body>
</html>